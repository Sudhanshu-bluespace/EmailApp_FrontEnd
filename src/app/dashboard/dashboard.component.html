<p-growl [value]="msgs"></p-growl>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">        
  google.load('visualization', '1.1', {
    'packages': ['corechart','bar']
  });
  
</script>
<div class="dashboardMainContainer" style="min-height:110vh;">
<md-card class="app-input-section">
	<div id="refresh-button">
			<!--button type="submit" class="btn btn-success btn-s" (click)="refreshStats()">Refresh Statistics</button-->
			<button type="button" class="btn btn-success btn-s" (click)="refreshStats()" ripple-radius style="float:right;margin-right:20px;">Refresh Statistics</button>
	</div>
			<md-card-title>
					<span><img src="../../app/resources/images/jobstatsicon.png" style="width:65px;height:60px;margin-right:15px;opacity:100;"/></span><span>Job Statistics (Queued)</span>
			</md-card-title>
			<md-card-content>
				<p-dataTable [value]="jobstatusdataQueued" [rows]="10" [paginator]="true"
        [pageLinks]="3" [rowsPerPageOptions]="[10,20]" selectionMode="single" [(selection)]="selectedJob" [responsive]="true" [contextMenu]="cm">
        <header>Job Status Statistics (Queued)</header>
				<header>Right click on a row to request cancellation</header>
        <p-column  field="jobId" header="Job ID" [sortable]="true" [filter]="true"></p-column>
        <p-column  field="batchId" header="Batch Id" [sortable]="true" [filter]="true"></p-column>
        <p-column  field="requestId" header="Request ID" [sortable]="true" [filter]="true"></p-column>
        <p-column  field="campaignName" header="Campaign Name" [sortable]="true" [filter]="true"></p-column>
				<p-column  field="emailCount" header="Total Contacts" [sortable]="true" [filter]="true"></p-column>
				<p-column  field="sender" header="Sender" [sortable]="true" [filter]="true"></p-column>
				<p-column  field="status" header="Status" [sortable]="true" [filter]="false"></p-column>
        <footer>
        </footer>
      </p-dataTable>
			<p-contextMenu #cm [model]="datatable_menu_items"></p-contextMenu>
			</md-card-content>
			<br><br>
			<md-card-title>
					<span><img src="../../app/resources/images/jobcompletedicon.png" style="width:60px;height:60px;margin-right:15px;opacity:100;"/></span><span> Job Statistics (Completed)</span>
			</md-card-title>
			<md-card-content>
				<p-dataTable [value]="jobstatusdataCompleted" [rows]="10" [paginator]="true"
        [pageLinks]="3" [rowsPerPageOptions]="[10,20]" selectionMode="single" [responsive]="true">
        <header>Job Status Statistics (Completed)</header>
        <p-column field="jobId" header="Job ID" [sortable]="true" [filter]="true"></p-column>
        <p-column field="batchId" header="Batch Id" [sortable]="true" [filter]="true"></p-column>
        <p-column field="requestId" header="Request ID" [sortable]="true" [filter]="true"></p-column>
        <p-column field="campaignName" header="Campaign Name" [sortable]="true" [filter]="true"></p-column>
				<p-column field="emailCount" header="Total Contacts" [sortable]="true" [filter]="true"></p-column>
				<p-column field="sender" header="Sender" [sortable]="true" [filter]="true"></p-column>
				<p-column field="status" header="Status" [sortable]="true" [filter]="false"></p-column>
				<p-column field="comments" header="Remarks" [sortable]="true" [filter]="false"></p-column>
        <footer>
        </footer>
      </p-dataTable>
			</md-card-content>
			<br><br>
						<md-card-title>
					<span><img src="../../app/resources/images/jobfailedicon.png" style="width:60px;height:60px;margin-right:15px;opacity:100;"/></span><span>Job Statistics (Failed)</span>
			</md-card-title>
			<md-card-content>
				<p-dataTable [value]="jobstatusdataFailed" [rows]="10" [paginator]="true"
        [pageLinks]="3" [rowsPerPageOptions]="[10,20]" selectionMode="single" [responsive]="true">
        <header>Job Status Statistics (Failed)</header>
        <p-column field="jobId" header="Job ID" [sortable]="true" [filter]="true"></p-column>
        <p-column field="batchId" header="Batch Id" [sortable]="true" [filter]="true"></p-column>
        <p-column field="requestId" header="Request ID" [sortable]="true" [filter]="true"></p-column>
        <p-column field="campaignName" header="Campaign Name" [sortable]="true" [filter]="true"></p-column>
				<p-column field="emailCount" header="Total Contacts" [sortable]="true" [filter]="true"></p-column>
				<p-column field="sender" header="Sender" [sortable]="true" [filter]="true"></p-column>
				<!--p-column field="status" header="Status" [sortable]="true" [filter]="false"></p-column-->
				<p-column field="comments" header="Failure Reason" [sortable]="true" [filter]="false"></p-column>
        <footer>
        </footer>
      </p-dataTable>
			</md-card-content>
			<br><br>
			<div *ngIf="admin">
			<md-card-title>
					<span><img src="../../app/resources/images/blockedcontacticon.png" style="width:60px;height:60px;margin-right:15px;opacity:100;"/></span><span>Blocked / Bounced Contacts</span>
			</md-card-title>
			<md-card-content>
				<p-dataTable [value]="blockedContacts" [rows]="10" [paginator]="true"
        	[pageLinks]="3" [rowsPerPageOptions]="[10,20]" selectionMode="single" [responsive]="true">
        	<header>Contacts Blocked due to Bounces / Failures</header>
        	<p-column field="firstName" header="First Name" [sortable]="true" [filter]="true"></p-column>
        	<p-column field="lastName" header="Last Name" [sortable]="true" [filter]="true"></p-column>
        	<p-column field="email" header="Email" [sortable]="true" [filter]="true"></p-column>
        	<p-column field="reason" header="Reason" [sortable]="true" [filter]="true"></p-column>
					<p-column field="responseCode" header="Response Code" [sortable]="true" [filter]="true"></p-column>
        	<footer>
        	</footer>
      	</p-dataTable>
			</md-card-content>
			</div>
			<br><br>
      <md-card-title>
				<span><img src="../../app/resources/images/summary.png" style="width:60px;height:60px;margin-right:15px;opacity:100;"/></span><span>Recent Campaign Summary</span>
	  </md-card-title>
      <md-card-content>
              <p> See your most recent campaign summary here </p>
			  <div id="summaryContainer">			  
				  <div id="summary-left">
					<h4 #emailSubject></h4>
					<h6 #sentOnDate></h6>
				  </div>
				  <div id="summary-right">
					<h4> Statistical Summary </h4>
					<p #description>
						This is a section that gives a summarized text for the most recent campaign held from your account. It provides insight on whom the campaign was targeted to and to which groups. 
						It also provides insights on the statistical insights for the campaign.
					</p>
				  </div>
			  </div>
			  <div id="chartContainer">
			    <div id="chart">
						<google-chart [data]='barChartOptions'></google-chart>
					</div>
					<div id="tabularData">
						<table>
							<thead>
								<tr class="odd">
									<td>Statistical Analysis</td>
									<td>Hit Percentage</td>
								</tr>
							</thead>
							<tr class="totalreach">
								<td>Total Reach</td>
								<td #reachPercentage></td>
							</tr>
							<tr class="clicks">
								<td>Total clicks</td>
								<td #clickPercentage></td>
							</tr>
							<tr class="unsubscribe">
								<td>Usubscribes</td>
								<td #unsubscribePercentage></td>
							</tr>
						</table>					
					</div>
			  </div>
      </md-card-content>
			<md-card-title>
				<span><img src="../../app/resources/images/unsubscribedicon.png" style="width:60px;height:60px;margin-right:15px;opacity:100;"/></span><span>Recent Unsubscriptions</span>
	  	</md-card-title>
			<md-card-content>
			  <p> Check how many people have opted out of this portal </p>
			  <div id="summaryContainer">
					<div id="summary-left">
						<h4>Recent Unsubscription Statistics</h4>
						<h6>A graphical representation of number of unsubscriptions per day</h6>
				  </div>	  
				  <div id="summary-right">
					<h4> Unsubscription records </h4>
					<p>
						This is a section that gives a summary of recent unsubscribes for the last 60 days
					</p>
				  </div>
			  </div>
			  <div id="chartContainer">
			  	<div id="chart">
						<google-chart [data]='unsubscribeLineChartOptions'></google-chart>
					</div>
					<div id="tabularData">
				    <table>
                <thead>
                    <tr>
                        <td>Serial No</td>
                        <td>Contact Name</td>
                        <td>Email</td>
												<td>Date</td>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngIf="noDataFound">
                        <td colspan="8">No unsubscriptions found</td>            
                    </tr>
                        <tr *ngFor="let data of unsubscribes" [ngClass]="getClass(data.serialNo)">
                            <td>{{data.serialNo}}</td>
                            <td>{{data.firstName}} {{data.lastName}}</td>
                            <td>{{data.email}}</td>
														<td>{{data.unsubscribedOn}}</td>
                        </tr>
                </tbody>
            </table>					
					</div>
			  </div>
      </md-card-content>
</md-card>
</div>
